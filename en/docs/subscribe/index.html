<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Subscription Changes | Kurimudb</title>
    <meta name="description" content="Just playing around.">
    <link rel="stylesheet" href="/assets/style.9de7d475.css">
    <link rel="modulepreload" href="/assets/Home.14835f7f.js">
    <link rel="modulepreload" href="/assets/app.197c0aa2.js">
    <link rel="modulepreload" href="/assets/en_docs_subscribe_index.md.1e56fde3.lean.js">
    <link rel="modulepreload" href="/assets/app.197c0aa2.js">
    <link rel="icon" href="favicon.png">
    <meta name="twitter:title" content="Subscription Changes | Kurimudb">
    <meta property="og:title" content="Subscription Changes | Kurimudb">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/en/" aria-label="Kurimudb, back to home" data-v-675d8756 data-v-4a583abe><!----> Kurimudb</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb/releases" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Changelog <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Languages</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/docs/subscribe/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>简体中文</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item active" href="/en/docs/subscribe/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>English</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb/releases" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Changelog <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Languages</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/docs/subscribe/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>简体中文</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item active" href="/en/docs/subscribe/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>English</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">文档(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/intro/">入门(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/model/">模型(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/persistence/">持久化(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/en/docs/subscribe/">订阅变更(English)</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#subscription">Subscription</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#batch-subscription">Batch Subscription</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#automatic-subscription">Automatic Subscription</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#global-automatic-subscription">Global Automatic Subscription</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#subscribe-models">Subscribe Models</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#unsubscriptions">Unsubscriptions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#auto-unubscriptions">Auto Unubscriptions</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#vue3">Vue3</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#react">React</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ignore-automatic-unsubscriptions">Ignore Automatic Unsubscriptions</a><!----></li></ul></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/typescript/">TypeScript(English)</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">驱动(English)</p><ul class="sidebar-links"><li class="sidebar-link"><p class="sidebar-link-item">浏览器驱动(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/localstorage">LocalStorage(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/cookie">Cookie(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/dexie">Dexie (IndexedDB)(English)</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">其他驱动(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/taro">Taro(English)</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/custom-driver">自定义驱动(English)</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">迁移(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/migrations/v4">从 v4 迁移(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/migrations/v3">从 v3 迁移(English)</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/bestPractices/">最佳实践(English)</a><!----></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="subscription-changes" tabindex="-1">Subscription Changes <a class="header-anchor" href="#subscription-changes" aria-hidden="true">#</a></h1><h2 id="subscription" tabindex="-1">Subscription <a class="header-anchor" href="#subscription" aria-hidden="true">#</a></h2><p>In Kurimudb，<code>$</code> stands for <code>subscribe</code>。You can add a <code>$</code> after a value to suscribe its changes:</p><div class="language-js line-numbers-mode"><pre><code>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">foo$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>By default, the closure function will be executed immediately, so that you can assign initial values to the reactive variables in your view. If you don&#39;t want to do so, but only want to execute it when the subsequent value changes, then the following can be done:</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br></div><pre><code>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">foo$</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> immediate<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>You can also use in form of <a href="/en/docs/model/#api-similar-to-the-storage-object">API Similar to the Storage Object</a> to subscribe：</p><div class="language-js line-numbers-mode"><pre><code>configState<span class="token punctuation">.</span><span class="token function">subscribeItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> closFunc<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="batch-subscription" tabindex="-1">Batch Subscription <a class="header-anchor" href="#batch-subscription" aria-hidden="true">#</a></h2><p>If you want to subscribe to changes of multiple values at once, you can use function <code>batch$</code>:</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> batch$ <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;kurimudb&#39;</span><span class="token punctuation">;</span>

<span class="token function">batch$</span><span class="token punctuation">(</span><span class="token punctuation">[</span>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>foo$<span class="token punctuation">,</span> configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>bar$<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="automatic-subscription" tabindex="-1">Automatic Subscription <a class="header-anchor" href="#automatic-subscription" aria-hidden="true">#</a></h2><p>It may be a bit cumbersome to manually declare the value to be subscribed, so we also provide a more convenient way. When any of the values you use in the closure is changed, a subscription will be triggered:</p><div class="language-js line-numbers-mode"><pre><code>configState<span class="token punctuation">.</span><span class="token function">auto$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>During the first execution of the closure function, Kurimudb collects which values are read and then subscribes to them. Therefore, the closure function must be synchronized.</p><h2 id="global-automatic-subscription" tabindex="-1">Global Automatic Subscription <a class="header-anchor" href="#global-automatic-subscription" aria-hidden="true">#</a></h2><p>The scope of the automatic subscription function <strong>mentioned above is your model</strong>. If you read the data of an external model in it, you will not be subscribed. If you want to automatically subscribe to the data of any model, you can use the global automatic subscription:</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> auto$ <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;kurimudb&#39;</span><span class="token punctuation">;</span>

<span class="token function">auto$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fooState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>barState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>::: Warning Tips</p><p>Unlike the automatic subscription function, due to JavaScript limitations, the global automatic subscription function does not apply to the <strong>asynchronous model</strong>. We thought of a workaround to implement the global automatic subscription function that supports the asynchronous model, but this function is still under development.</p><p>:::</p><h2 id="subscribe-models" tabindex="-1">Subscribe Models <a class="header-anchor" href="#subscribe-models" aria-hidden="true">#</a></h2><p>You can also subscribe to changes in the entire model. When any value in the model changes, the closure function will be triggered.</p><p>This is usually used in scenarios where you don&#39;t know which value you want to subscribe to, such as <strong>the collection model</strong>. A common example: a collection model for storing drafts. The view needs to change immediately when the user saves, adds or deletes drafts. This will come in handy here.</p><p>If you want to subscribe to the changes of models, just call the function <code>yourModel.$</code>.</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre><code>ref<span class="token operator">:</span> currentDraftData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

draftList<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  currentDraftData <span class="token operator">=</span> draftList<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// in view..</span>

draftList<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="unsubscriptions" tabindex="-1">Unsubscriptions <a class="header-anchor" href="#unsubscriptions" aria-hidden="true">#</a></h2><p>When you execute subscription function, the return value will be a cancelling subscription function. The subscription will be unsubscribed after you execute it:</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">foo$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// unsubscribe</span>
<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="auto-unubscriptions" tabindex="-1">Auto Unubscriptions <a class="header-anchor" href="#auto-unubscriptions" aria-hidden="true">#</a></h2><p>If you are using Vue/React or other frameworks, you probably hope to see all subscriptions generated in the components will be automatically unsubscribed when the components are destroyed.</p><p>You can mount a function to <code>kurimudbConfig.autoUnsubscribe</code>. This function will be executed every time the subscription function is executed. You can use it in conjunction with the lifecycle APIs of the framework to realize automatic unsubscriptions.</p><h3 id="vue3" tabindex="-1">Vue3 <a class="header-anchor" href="#vue3" aria-hidden="true">#</a></h3><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// 你可以把这些代码，写在你项目的 index.js 里</span>
<span class="token comment">// 在你任何 vue 组件被实例化之前执行</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> onBeforeUnmount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> globalConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;kurimudb&#39;</span><span class="token punctuation">;</span>

globalConfig<span class="token punctuation">.</span><span class="token function">setAutoUnsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">unsubscribe</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="react" tabindex="-1">React <a class="header-anchor" href="#react" aria-hidden="true">#</a></h3><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// 你可以把这些代码，写在你项目的 index.js 里</span>
<span class="token comment">// 在你任何 react 组件被实例化之前执行</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> onBeforeUnmount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> globalConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;kurimudb&#39;</span><span class="token punctuation">;</span>

globalConfig<span class="token punctuation">.</span><span class="token function">setAutoUnsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">unsubscribe</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="ignore-automatic-unsubscriptions" tabindex="-1">Ignore Automatic Unsubscriptions <a class="header-anchor" href="#ignore-automatic-unsubscriptions" aria-hidden="true">#</a></h3><p>If you don&#39;t want it to be automatically unsubscribed automatically in several scenarios when enable auto unsubscriptions, you can do it like this as following:</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br></div><pre><code>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">foo$</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> autoUnsubscribe<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/en/docs/persistence/" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>持久化(English)</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/en/docs/typescript/" data-v-38ede35f><span class="text" data-v-38ede35f>TypeScript(English)</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"bestpractices_index.md\":\"30a3b89a\",\"docs_intro_index.md\":\"352be33d\",\"docs_model_index.md\":\"fe4a996f\",\"docs_persistence_index.md\":\"1d0b6cf0\",\"docs_subscribe_index.md\":\"774ab92a\",\"docs_typescript_index.md\":\"56b725a5\",\"drivers_cookie.md\":\"ca280df5\",\"drivers_custom-driver.md\":\"39a9242c\",\"drivers_dexie.md\":\"baab3850\",\"drivers_localstorage.md\":\"79a66a96\",\"drivers_taro.md\":\"d52983d8\",\"en_docs_intro_index.md\":\"72df42ce\",\"en_docs_model_index.md\":\"8023707e\",\"en_docs_persistence_index.md\":\"4ffde3e1\",\"en_docs_subscribe_index.md\":\"1e56fde3\",\"en_docs_typescript_index.md\":\"e914166f\",\"en_drivers_cookie.md\":\"297a926e\",\"en_drivers_custom-driver.md\":\"d4177ab5\",\"en_drivers_dexie.md\":\"3a2d274b\",\"en_drivers_localstorage.md\":\"8fc1399c\",\"en_drivers_taro.md\":\"9724211b\",\"en_index.md\":\"7ae69e90\",\"en_migrations_v3.md\":\"8da9ecdc\",\"en_migrations_v4.md\":\"c268717e\",\"en_others_index.md\":\"9945ceee\",\"index.md\":\"95cd4f42\",\"migrations_v3.md\":\"27dad1e7\",\"migrations_v4.md\":\"75ba0549\",\"others_index.md\":\"cdf93d44\"}")</script>
    <script type="module" async src="/assets/app.197c0aa2.js"></script>
    
  </body>
</html>