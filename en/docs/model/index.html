<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Model | Kurimudb</title>
    <meta name="description" content="Just playing around.">
    <link rel="stylesheet" href="/assets/style.9de7d475.css">
    <link rel="modulepreload" href="/assets/Home.14835f7f.js">
    <link rel="modulepreload" href="/assets/app.197c0aa2.js">
    <link rel="modulepreload" href="/assets/en_docs_model_index.md.8023707e.lean.js">
    <link rel="modulepreload" href="/assets/app.197c0aa2.js">
    <link rel="icon" href="favicon.png">
    <meta name="twitter:title" content="Model | Kurimudb">
    <meta property="og:title" content="Model | Kurimudb">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/en/" aria-label="Kurimudb, back to home" data-v-675d8756 data-v-4a583abe><!----> Kurimudb</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb/releases" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Changelog <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Languages</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/docs/model/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>简体中文</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item active" href="/en/docs/model/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>English</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb/releases" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Changelog <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/akirarika/kurimudb" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Languages</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/docs/model/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>简体中文</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item active" href="/en/docs/model/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>English</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">文档(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/intro/">入门(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/en/docs/model/">模型(English)</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#getting-started">Getting Started</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#create-a-model">Create a Model</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#api-similar-to-the-storage-object">API Similar to the Storage Object</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#model-methods">Model Methods</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#collection-model">Collection Model</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#key-generator">Key Generator</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#nuid">NUID</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#model-seeding">Model Seeding</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/persistence/">持久化(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/subscribe/">订阅变更(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/docs/typescript/">TypeScript(English)</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">驱动(English)</p><ul class="sidebar-links"><li class="sidebar-link"><p class="sidebar-link-item">浏览器驱动(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/localstorage">LocalStorage(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/cookie">Cookie(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/dexie">Dexie (IndexedDB)(English)</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">其他驱动(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/taro">Taro(English)</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/drivers/custom-driver">自定义驱动(English)</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">迁移(English)</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/en/migrations/v4">从 v4 迁移(English)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/migrations/v3">从 v3 迁移(English)</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/en/bestPractices/">最佳实践(English)</a><!----></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="model" tabindex="-1">Model <a class="header-anchor" href="#model" aria-hidden="true">#</a></h1><p>In the preamble, we introduced the basic usage and used the zero config library, <code>kurimudb-zero-config</code>. Normally, this would have already satisfied our needs.</p><p>However, if we are currently developing a complex single-page application, do we really want to save various kinds of data messily in a single object? This is not a good idea.</p><p>This is the time for <strong>Model feature</strong> to make its grand debut！ 🎉</p><h2 id="getting-started" tabindex="-1">Getting Started <a class="header-anchor" href="#getting-started" aria-hidden="true">#</a></h2><p>Models are the core of saving and managing your data. The <code>memory</code>、<code>local</code>、<code>cookie</code> and <code>db</code> objects we previously used in our zero config library are actually all models!</p><p>Before we continue, let&#39;s install Kurimudb:</p><div class="language-bash line-numbers-mode"><pre><code><span class="token function">npm</span> i kurimudb@5
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="create-a-model" tabindex="-1">Create a Model <a class="header-anchor" href="#create-a-model" aria-hidden="true">#</a></h2><p>Creating a model is actually very simple. You only need to inherit the Kurimudb&#39;s Model class.</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// create a file /models/configState.js</span>
<span class="token comment">// we can use it to store data related to user configuration</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SyncModels <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;kurimudb&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name">ConfigState</span> <span class="token keyword">extends</span> <span class="token class-name">SyncModels<span class="token punctuation">.</span>keyValue</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// model name is required; must be globally unique</span>
      name<span class="token operator">:</span> <span class="token string">&#39;ConfigState&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Just like this, you will have a <code>ConfigState</code> model. You can read and write the data inside it like an ordinary object:</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> configState <span class="token keyword">from</span> <span class="token string">&#39;./models/configState.js&#39;</span><span class="token punctuation">;</span>

configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>say <span class="token operator">=</span> <span class="token string">&#39;hello world&#39;</span><span class="token punctuation">;</span> <span class="token comment">// writing..</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>say<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// reading..</span>
<span class="token keyword">delete</span> configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>say<span class="token punctuation">;</span> <span class="token comment">// deleting..</span>
<span class="token string">&#39;say&#39;</span> <span class="token keyword">in</span> configState<span class="token punctuation">;</span> <span class="token comment">// check existence..</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="api-similar-to-the-storage-object" tabindex="-1">API Similar to the Storage Object <a class="header-anchor" href="#api-similar-to-the-storage-object" aria-hidden="true">#</a></h2><p>If you have used <code>localStorage</code>, you will be familiar with this method:</p><div class="language-js line-numbers-mode"><pre><code>local<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;say&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// setting</span>
<span class="token keyword">let</span> say <span class="token operator">=</span> local<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;say&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obtaining</span>
local<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">&#39;say&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// deleting</span>
local<span class="token punctuation">.</span><span class="token function">subscribeItem</span><span class="token punctuation">(</span><span class="token string">&#39;say&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// subscription data mutating</span>
local<span class="token punctuation">.</span><span class="token function">bulkSetItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  say<span class="token operator">:</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">,</span>
  then<span class="token operator">:</span> <span class="token string">&#39;goodbye&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// batch setting</span>
local<span class="token punctuation">.</span><span class="token function">bulkGetItem</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;say&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;then&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// batch obtaining</span>
local<span class="token punctuation">.</span><span class="token function">bulkRemoveItem</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;say&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;then&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// batch deleting</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>The functions of the batch operation are all <strong>atomic</strong>. If the operation on some of the values fails, the previously successful value will be automatically rolled back.</p><p>Instead of manipulating data through the <code>data</code> object in the previous article, we actually <strong>prefer</strong> you to use the API similar to storage object. Explicitly called functions are more readable, and are not easily confused with ordinary objects and cause bugs.</p><h2 id="model-methods" tabindex="-1">Model Methods <a class="header-anchor" href="#model-methods" aria-hidden="true">#</a></h2><p>We can add <strong>any methods</strong> in the model class! Just like:</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// /models/configState.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Models <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;kurimudb&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ConfigState</span> <span class="token keyword">extends</span> <span class="token class-name">Models<span class="token punctuation">.</span>keyValue</span> <span class="token punctuation">{</span>
  <span class="token comment">// ..</span>

  <span class="token comment">// add a model method</span>
  <span class="token function">setFoo</span><span class="token punctuation">(</span><span class="token parameter">bar<span class="token punctuation">,</span> foo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// various logic..</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>foo <span class="token operator">=</span> foo<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>bar <span class="token operator">=</span> bar<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// the method can also be asychronous</span>
  <span class="token keyword">async</span> <span class="token function">calcBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">ConfigState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>Directly call the method when using it：</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> configState <span class="token keyword">from</span> <span class="token string">&#39;./models/configState.js&#39;</span><span class="token punctuation">;</span>

configState<span class="token punctuation">.</span><span class="token function">setFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> configState<span class="token punctuation">.</span><span class="token function">calcBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>We recommend that write the changes to the model data <strong>all in the method inside the model</strong>. The external only changes the data of the model by calling these methods. Following this simple agreement, in addition to making it easier to reuse code, it can also effectively decouple our applications and make it easier for you to track changes in data flow. Moreover, the changes to the model data are gathered in one place. When reading the code, it is easy to understand how the data changes.</p><h2 id="collection-model" tabindex="-1">Collection Model <a class="header-anchor" href="#collection-model" aria-hidden="true">#</a></h2><p>The models are divided into <strong>Key Value Model</strong> and <strong>Collection Model</strong>。Previously, the models that we used were all key-value values model, which acts like an object when used.</p><div class="language-js line-numbers-mode"><pre><code>state<span class="token punctuation">.</span>data<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Sometimes, we may need need a model in which the primary key is automatically incremented when adding data in a collective manner, somewhat similar to an array:</p><div class="language-js line-numbers-mode"><pre><code>list<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">700</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The common application scenarios of the collection model are various lists, such as the cached video list, the user&#39;s draft box list... Next, suppose we are developing a sticky note application and need to store the sticky notes written by the user locally.</p><p>Let&#39;s create a <code>NoteList</code> model：</p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// create a file /models/noteList.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SyncModels <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;kurimudb&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// inherit SyncModels.collection to make it a set model</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name">NoteList</span> <span class="token keyword">extends</span> <span class="token class-name">SyncModels<span class="token punctuation">.</span>collection</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&#39;NoteList&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>When using it, the primary key of data created through <code>insert</code> method will be auto incremented:</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> noteList <span class="token keyword">from</span> <span class="token string">&#39;@/models/noteList&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> note1 <span class="token operator">=</span> noteList<span class="token punctuation">.</span><span class="token function">insertItem</span><span class="token punctuation">(</span><span class="token string">&#39;This is the content of note 1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> note2 <span class="token operator">=</span> noteList<span class="token punctuation">.</span><span class="token function">insertItem</span><span class="token punctuation">(</span><span class="token string">&#39;This is the content of note 2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>noteList<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// echo &quot;This is the content of note 1&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>noteList<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// echo &quot;This is the content of note 2&quot;</span>

<span class="token keyword">const</span> keys <span class="token operator">=</span> noteList<span class="token punctuation">.</span><span class="token function">bulkInsertItem</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;note3&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;note4&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// echo [&quot;3&quot;, &quot;4&quot;]</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>::: Warning Tips:</p><ul><li>The primary key of the collection model is incremented from <code>1</code>, which is different from arrays. This design is for better compatibility with IndexedDB, because IndexedDB starts from <code>1</code>.</li><li>In the collection model, deleting any value will not cause the primary key of other values to change. In other words, the keys of the collection model can be regarded as unique and unchanging.</li></ul><p>:::</p><h3 id="key-generator" tabindex="-1">Key Generator <a class="header-anchor" href="#key-generator" aria-hidden="true">#</a></h3><p>We may hope that the user&#39;s data can be synchronized in the cloud, the user creates the data locally when the user is offline, and synchronizes with the cloud when the network is restored. In the collection model, if the primary key is incremented one by one, the user will have synchronization problems when using multiple devices.</p><p>To this end, we can add the <code>autoIncrementHandler</code> attribute to the model options to customize the primary key generation method, instead of the default auto-increment mode.</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br></div><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">class</span> <span class="token class-name">NoteList</span> <span class="token keyword">extends</span> <span class="token class-name">SyncModels<span class="token punctuation">.</span>collection</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&#39;NoteList&#39;</span><span class="token punctuation">,</span>
      <span class="token function">autoIncrementHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// return a globally unique distributed ID</span>
        <span class="token keyword">return</span> <span class="token string">&#39;9cac24ea-fe09-4280-927e-e378943d4aca&#39;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>::: Warning Tips</p><ul><li><p>In the synchronous model, it <strong>must be a synchronous function</strong>. If you need it to be an asynchronous function, please use the asynchronous model.</p></li><li><p>Its return value must be of type <code>string</code>. Because the largest integer that can be accurately represented by <code>number</code> in JavaScript is <code>2^53-1</code>, this will have precision problems for common purely digital distributed algorithms.</p></li></ul><p>:::</p><h3 id="nuid" tabindex="-1">NUID <a class="header-anchor" href="#nuid" aria-hidden="true">#</a></h3><p>We can use algorithms such as <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier" target="_blank" rel="noopener noreferrer">UUID</a>, <a href="https://en.wikipedia.org/wiki/Snowflake_ID" target="_blank" rel="noopener noreferrer">Snowflake ID</a> to generate the primary key. At the same time, we have designed a <strong>more general</strong> and distributed ID algorithm that is <strong>suitable for use in front-end business</strong>, which we call <strong>NUID</strong>:</p><div class="language-js line-numbers-mode"><pre><code><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>current millisecond timestamp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>random <span class="token function">number</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>In this algorithm, only the user of the current account generates multiple pieces of data within the same millisecond, and the probability of repetition of two pieces of data is <code>(1/10000)^2</code>, one in 100 million.</p><div class="language-"><pre><code>Invalid code snippet option</code></pre><div class="line-numbers-wrapper"></div></div><h1 id="一般来说，正常用户很难在同一毫秒新增多条数据，所以，在实际应用中重复的几率极低。主要可能重复的场景是在同一客户端，批量新增数据时产生。我们可以尝试在生成同一毫秒生成的-nuid-中，添加主动规避生成相同-id-的逻辑。" tabindex="-1">一般来说，正常用户很难在同一毫秒新增多条数据，所以，在实际应用中重复的几率极低。主要可能重复的场景是在同一客户端，批量新增数据时产生。我们可以尝试在生成同一毫秒生成的 NUID 中，添加主动规避生成相同 ID 的逻辑。 <a class="header-anchor" href="#一般来说，正常用户很难在同一毫秒新增多条数据，所以，在实际应用中重复的几率极低。主要可能重复的场景是在同一客户端，批量新增数据时产生。我们可以尝试在生成同一毫秒生成的-nuid-中，添加主动规避生成相同-id-的逻辑。" aria-hidden="true">#</a></h1><p>Generally speaking, it is almost impossible for a normal user to add multiple pieces of data in the same millisecond, so the chance of duplication in practical applications is extremely low. The main repetitive scenarios are generated when adding data in batches on the same client. The solution is that we can try to add logic to actively avoid generating the same ID in the NUID generated in the same millisecond.</p><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><p>da15f2179061787723092e2f5e825f2776e1eb24</p></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><h2 id="model-seeding" tabindex="-1">Model Seeding <a class="header-anchor" href="#model-seeding" aria-hidden="true">#</a></h2><p>We may want to pad initial values for some models. For example, we are working on an e-book application, and we hope to specify a default font size, theme, page turning mode for the user when he uses it for the first time...</p><p>We can call the <code>seed</code> method in the construction method of the model to pad the initial value:</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre><code><span class="token comment">// /models/configState.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SyncModels <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;kurimudb&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ConfigState</span> <span class="token keyword">extends</span> <span class="token class-name">SyncModels<span class="token punctuation">.</span>keyValue</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ..</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">seed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;fontSize&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;14px&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;theme&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;default&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;turningMode&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;roll&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>For the <strong>key-value model</strong>, you can pass in an object to simplify model seeding:</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">seed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">,</span>
  baz<span class="token operator">:</span> <span class="token string">&#39;qux&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// equivalent to：</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">seed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>baz <span class="token operator">=</span> <span class="token string">&#39;qux&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>For the <strong>collection model</strong>, you can pass in an array to simplify model seeding:</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">seed</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// equivalent to：</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">seed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&#39;bar&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>By default, every time you run your web page, data will be populated once. If the model is configured with <a href="/docs/persistence/">Storage Drive</a>, then data will only be padded when the user runs your web page for the first time.</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/en/docs/intro/" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>入门(English)</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/en/docs/persistence/" data-v-38ede35f><span class="text" data-v-38ede35f>持久化(English)</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"bestpractices_index.md\":\"30a3b89a\",\"docs_intro_index.md\":\"352be33d\",\"docs_model_index.md\":\"fe4a996f\",\"docs_persistence_index.md\":\"1d0b6cf0\",\"docs_subscribe_index.md\":\"774ab92a\",\"docs_typescript_index.md\":\"56b725a5\",\"drivers_cookie.md\":\"ca280df5\",\"drivers_custom-driver.md\":\"39a9242c\",\"drivers_dexie.md\":\"baab3850\",\"drivers_localstorage.md\":\"79a66a96\",\"drivers_taro.md\":\"d52983d8\",\"en_docs_intro_index.md\":\"72df42ce\",\"en_docs_model_index.md\":\"8023707e\",\"en_docs_persistence_index.md\":\"4ffde3e1\",\"en_docs_subscribe_index.md\":\"1e56fde3\",\"en_docs_typescript_index.md\":\"e914166f\",\"en_drivers_cookie.md\":\"297a926e\",\"en_drivers_custom-driver.md\":\"d4177ab5\",\"en_drivers_dexie.md\":\"3a2d274b\",\"en_drivers_localstorage.md\":\"8fc1399c\",\"en_drivers_taro.md\":\"9724211b\",\"en_index.md\":\"7ae69e90\",\"en_migrations_v3.md\":\"8da9ecdc\",\"en_migrations_v4.md\":\"c268717e\",\"en_others_index.md\":\"9945ceee\",\"index.md\":\"95cd4f42\",\"migrations_v3.md\":\"27dad1e7\",\"migrations_v4.md\":\"75ba0549\",\"others_index.md\":\"cdf93d44\"}")</script>
    <script type="module" async src="/assets/app.197c0aa2.js"></script>
    
  </body>
</html>