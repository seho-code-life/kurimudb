import{_ as n,c as s,o as a,a as t}from"./app.197c0aa2.js";const m='{"title":"Subscription Changes","description":"","frontmatter":{},"headers":[{"level":2,"title":"Subscription","slug":"subscription"},{"level":2,"title":"Batch Subscription","slug":"batch-subscription"},{"level":2,"title":"Automatic Subscription","slug":"automatic-subscription"},{"level":2,"title":"Global Automatic Subscription","slug":"global-automatic-subscription"},{"level":2,"title":"Subscribe Models","slug":"subscribe-models"},{"level":2,"title":"Unsubscriptions","slug":"unsubscriptions"},{"level":2,"title":"Auto Unubscriptions","slug":"auto-unubscriptions"},{"level":3,"title":"Vue 3","slug":"vue-3"},{"level":3,"title":"React","slug":"react"},{"level":3,"title":"Ignore Automatic Unsubscriptions","slug":"ignore-automatic-unsubscriptions"}],"relativePath":"en/docs/subscribe/index.md","lastUpdated":1635330282220}',e={},p=t(`<h1 id="subscription-changes" tabindex="-1">Subscription Changes <a class="header-anchor" href="#subscription-changes" aria-hidden="true">#</a></h1><h2 id="subscription" tabindex="-1">Subscription <a class="header-anchor" href="#subscription" aria-hidden="true">#</a></h2><p>In Kurimudb\uFF0C<code>$</code> stands for <code>subscribe</code>\u3002You can add a <code>$</code> after a value to suscribe its changes:</p><div class="language-js line-numbers-mode"><pre><code>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">foo$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>By default, the closure function will be executed immediately, so that you can assign initial values to the reactive variables in your view. If you don&#39;t want to do so, but only want to execute it when the subsequent value changes, then the following can be done:</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted">\xA0</div><br><br></div><pre><code>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">foo$</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> immediate<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>You can also use in form of <a href="/en/docs/model/#api-similar-to-the-storage-object">API Similar to the Storage Object</a> to subscribe\uFF1A</p><div class="language-js line-numbers-mode"><pre><code>configState<span class="token punctuation">.</span><span class="token function">subscribeItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> closFunc<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="batch-subscription" tabindex="-1">Batch Subscription <a class="header-anchor" href="#batch-subscription" aria-hidden="true">#</a></h2><p>If you want to subscribe to changes of multiple values at once, you can use function <code>batch$</code>:</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> batch$ <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;kurimudb&#39;</span><span class="token punctuation">;</span>

<span class="token function">batch$</span><span class="token punctuation">(</span><span class="token punctuation">[</span>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>foo$<span class="token punctuation">,</span> configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>bar$<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="automatic-subscription" tabindex="-1">Automatic Subscription <a class="header-anchor" href="#automatic-subscription" aria-hidden="true">#</a></h2><p>It may be a bit cumbersome to manually declare the value to be subscribed, so we also provide a more convenient way. When any of the values you use in the closure is changed, a subscription will be triggered:</p><div class="language-js line-numbers-mode"><pre><code>configState<span class="token punctuation">.</span><span class="token function">auto$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>During the first execution of the closure function, Kurimudb collects which values are read and then subscribes to them. Therefore, the closure function must be synchronized.</p><h2 id="global-automatic-subscription" tabindex="-1">Global Automatic Subscription <a class="header-anchor" href="#global-automatic-subscription" aria-hidden="true">#</a></h2><p>The scope of the automatic subscription function <strong>mentioned above is your model</strong>. If you read the data of an external model in it, you will not be subscribed. If you want to automatically subscribe to the data of any model, you can use the global automatic subscription:</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> auto$ <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;kurimudb&#39;</span><span class="token punctuation">;</span>

<span class="token function">auto$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fooState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>barState<span class="token punctuation">.</span>data<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>::: Warning Tips</p><p>Unlike the automatic subscription function, due to JavaScript limitations, the global automatic subscription function does not apply to the <strong>asynchronous model</strong>. We thought of a workaround to implement the global automatic subscription function that supports the asynchronous model, but this function is still under development.</p><p>:::</p><h2 id="subscribe-models" tabindex="-1">Subscribe Models <a class="header-anchor" href="#subscribe-models" aria-hidden="true">#</a></h2><p>You can also subscribe to changes in the entire model. When any value in the model changes, the closure function will be triggered.</p><p>This is usually used in scenarios where you don&#39;t know which value you want to subscribe to, such as <strong>the collection model</strong>. A common example: a collection model for storing drafts. The view needs to change immediately when the user saves, adds or deletes drafts. This will come in handy here.</p><p>If you want to subscribe to the changes of models, just call the function <code>yourModel.$</code>.</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><br><br><br><br><br><br><br></div><pre><code>ref<span class="token operator">:</span> currentDraftData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

draftList<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  currentDraftData <span class="token operator">=</span> draftList<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// in view..</span>

draftList<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="unsubscriptions" tabindex="-1">Unsubscriptions <a class="header-anchor" href="#unsubscriptions" aria-hidden="true">#</a></h2><p>When you execute subscription function, the return value will be a cancelling subscription function. The subscription will be unsubscribed after you execute it:</p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">foo$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// unsubscribe</span>
<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="auto-unubscriptions" tabindex="-1">Auto Unubscriptions <a class="header-anchor" href="#auto-unubscriptions" aria-hidden="true">#</a></h2><p>If you are using Vue/React or other frameworks, you probably hope to see all subscriptions generated in the components will be automatically unsubscribed when the components are destroyed.</p><p>You can mount a function to <code>kurimudbConfig.autoUnsubscribe</code>. This function will be executed every time the subscription function is executed. You can use it in conjunction with the lifecycle APIs of the framework to realize automatic unsubscriptions.</p><h3 id="vue-3" tabindex="-1">Vue 3 <a class="header-anchor" href="#vue-3" aria-hidden="true">#</a></h3><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> onBeforeUnmount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> kurimudbConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;kurimudb&#39;</span><span class="token punctuation">;</span>

kurimudbConfig<span class="token punctuation">.</span><span class="token function-variable function">autoUnsubscribe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">unsubscribe</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="react" tabindex="-1">React <a class="header-anchor" href="#react" aria-hidden="true">#</a></h3><p>To be continued... \u{1F438}</p><h3 id="ignore-automatic-unsubscriptions" tabindex="-1">Ignore Automatic Unsubscriptions <a class="header-anchor" href="#ignore-automatic-unsubscriptions" aria-hidden="true">#</a></h3><p>If you don&#39;t want it to be automatically unsubscribed automatically in several scenarios when enable auto unsubscriptions, you can do it like this as following:</p><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted">\xA0</div><br><br></div><pre><code>configState<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">foo$</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> autoUnsubscribe<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>`,39),o=[p];function c(u,i,l,r,b,k){return a(),s("div",null,o)}var h=n(e,[["render",c]]);export{m as __pageData,h as default};
